{% extends "tupie_app/base.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="container">
  <h2>Inbox</h2>

{% if convo_data %}
  <table class="requests-table">
    <thead>
      <tr>
        <th>Participant</th>
        <th>Last Message</th>
        <th>Time</th>
        <th>Unread</th>
      </tr>
    </thead>
    <tbody>
      {% for convo in convo_data %}
        {% with other_user=convo.other_users.0 %}
          <tr onclick="location.href='{% url 'tupie_app:conversation' conversation_id=convo.conversation.id %}'" style="cursor:pointer;">
            <td>
              {{ other_user.username }}
              {% include "tupie_app/partials/_verification_badge.html" with user_profile=other_user.userprofile %}
            </td>
            <td>
              {% if convo.last_message %}
                {{ convo.last_message.content|truncatechars:40 }}
              {% else %}
                No messages yet
              {% endif %}
            </td>
            <td>
              {% if convo.last_message %}
                {{ convo.last_message.timestamp|naturaltime }}
              {% endif %}
            </td>
            <td>
              {% if convo.unread_count > 0 %}
                <span class="badge bg-danger">{{ convo.unread_count }}</span>
              {% else %}
                <span class="text-muted">0</span>
              {% endif %}
            </td>
          </tr>
        {% endwith %}
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No conversations yet.</p>
{% endif %}
{% endblock %}
